---
- name: wipe existing sources.list
  copy:
    content: '# Empty'
    dest: /etc/apt/sources.list
    force: true

- name: set up debian mirror
  apt_repository:
    repo: "{{ item }}"
    update_cache: true
  with_items: "{{ apt_repositories }}"

- name: set up percona repo
  apt:
    deb: https://repo.percona.com/apt/percona-release_0.1-4.{{ ansible_distribution_release }}_all.deb
    update_cache: yes

- name: Perform a full upgrade
  apt:
    upgrade: dist
    update_cache: yes
    dpkg_options: 'force-confold,force-confdef'
  when: "ansible_ssh_user != 'vagrant'"

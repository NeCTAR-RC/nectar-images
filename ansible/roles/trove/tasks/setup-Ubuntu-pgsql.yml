---
- include: setup-Ubuntu-trove.yml

- name: Adding postgresql key
  apt_key:
    url: "https://www.postgresql.org/media/keys/ACCC4CF8.asc"
    state: present

- name: Adding postregsql repo
  apt_repository:
    repo: deb http://apt.postgresql.org/pub/repos/apt/ {{ ansible_distribution_release }}-pgdg main
    state: present

- name: Updating cache
  apt:
   update_cache: yes

- name: Install postgresql
  apt:
    name: "{{ item }}"
    update_cache: yes
  with_items:
    - python-psycopg2
    - postgresql-9.4

- name: restart postgresql
  service:
    name: postgresql
    state: restarted

#- name: Write PostgresSQL password to security file
#  copy:
#    dest: /root/.pgsql_secret
#    content: "# The random password set for the root user at {{ ansible_date_time.date }} (local time): {{ generated_password }}\n"

#- name: Set initial PostgreSQL password
#  postgresql_user:
#    name: root
#    password: "{{ generated_password }}"
#  become_method: su
#  become_user: postgres

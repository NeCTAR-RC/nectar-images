---
- name: Include OS-specific variables
  include_vars: "{{ vars_item }}"
  with_first_found:
    - "{{ ansible_distribution }}_{{ ansible_distribution_major_version }}.yml"
    - "{{ ansible_distribution }}_{{ ansible_distribution_release }}.yml"
    - "{{ ansible_distribution }}.yml"
    - default.yml
  loop_control:
    loop_var: vars_item

- name: Include OS-specific tasks
  include: "{{ tasks_item }}"
  with_first_found:
    - "setup-{{ ansible_distribution }}_{{ ansible_distribution_major_version }}.yml"
    - "setup-{{ ansible_distribution }}_{{ ansible_distribution_release }}.yml"
  loop_control:
    loop_var: tasks_item

# These are referenced in the config murano pushes to the client
- name: Create Murano directories
  file:
    path: "{{ item }}"
    state: directory
    mode: 0775
    recurse: yes
  with_items:
    - /etc/murano
    - /var/murano/plans

- name: Enable murano guest agent service
  service:
    name: "{{ murano_agent_service_name }}"
    enabled: yes

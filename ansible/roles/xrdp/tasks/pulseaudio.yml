---
#- name: Ensure PulseAudio is enabled for the user account
#  ansible.builtin.systemd_service:
#    name: pulseaudio.service
#    enabled: true

# To build, follow the instructions from
#  https://github.com/neutrinolabs/pulseaudio-module-xrdp/wiki/README
- name: Install XRDP PulseAudio modules
  copy:
    src: "xrdp-pulseaudio/{{ pulseaudio_files_dir }}/{{ item }}"
    dest: "{{ pulseaudio_modules_dir }}/{{ item }}"
  with_items:
    - module-xrdp-sink.la
    - module-xrdp-sink.so
    - module-xrdp-source.la
    - module-xrdp-source.so

- name: Install pulseaudio-xrdp.desktop
  copy:
    src: "xrdp-pulseaudio/{{ pulseaudio_files_dir }}/pulseaudio-xrdp.desktop"
    dest: /etc/xdg/autostart/pulseaudio-xrdp.desktop

- name: Create xrdp-pulseaudio-installer directory
  file:
    path: /libexec/pulseaudio-module-xrdp
    state: directory

- name: Install load_pa_modules.sh
  copy:
    src: "xrdp-pulseaudio/{{ pulseaudio_files_dir }}/load_pa_modules.sh"
    dest: /libexec/pulseaudio-module-xrdp/load_pa_modules.sh
    mode: '0755'

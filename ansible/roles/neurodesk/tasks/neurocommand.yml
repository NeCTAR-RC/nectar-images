---
- name: Clone NeuroDesk repository
  ansible.builtin.git:
    repo: https://github.com/neurodesk/neurocommand.git
    dest: /neurocommand
    version: main

- name: Install NeuroCommand
  ansible.builtin.command: "{{ item }}"
  args:
    chdir: /neurocommand
    creates: /usr/share/applications/neurodesk
  with_items:
    - ./build.sh --lxde --edit
    - ./install.sh

- name: Prepare a container directory for users developing their own containers and testing them before release
  ansible.builtin.file:
    path: /neurocommand/local/containers
    state: directory
    mode: "0777"

- name: Copy Neurocommand update script
  ansible.builtin.copy:
    src: neurocommand-update.sh
    dest: /usr/local/sbin/neurocommand-update.sh
    mode: "0755"

- name: Copy Neurocommand update systemd unit file
  ansible.builtin.copy:
    src: neurocommand-update.service
    dest: /etc/systemd/system/neurocommand-update.service
    mode: "0644"

- name: Enable Neurocommand update service
  ansible.builtin.systemd:
    name: neurocommand-update
    enabled: true
